{"version":3,"sources":["../src/IterableAsync.ts"],"sourcesContent":["import {IsEqual} from \"./Util\";\r\n\r\n/**\r\n * Breaks an iterable into array chunks\r\n * ```js\r\n * chunks([1,2,3,4,5,6,7,8,9,10], 3);\r\n * // Yields [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]\r\n * ```\r\n * @param it \r\n * @param size \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* chunks<V>(it:Iterable<V>, size:number) {\r\n  // Source: https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-let\r\n  let buffer = [];\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) {\r\n    //eslint-disable-next-line functional/immutable-data\r\n    buffer.push(v);\r\n    if (buffer.length === size) {\r\n      yield buffer;\r\n      buffer = [];\r\n    }\r\n  }\r\n  if (buffer.length > 0) yield buffer;\r\n}\r\n\r\n/**\r\n * Return concatenation of iterators\r\n * @param its \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* concat<V>(...its:readonly Iterable<V>[]) {\r\n  // Source: https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const it of its) yield* it;\r\n}\r\n\r\n/**\r\n * Drops elements that do not meet the predicate `f`.\r\n * ```js\r\n * dropWhile([1, 2, 3, 4], e => e < 3);\r\n * returns [3, 4]\r\n * ```\r\n * @param it \r\n * @param f \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* dropWhile<V>(it:AsyncIterable<V>, f:(v:V) => boolean) {\r\n  // https://surma.github.io/underdash/\r\n  //const iit = it[Symbol.asyncIterator]();\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) { \r\n    if (!f(v)) {\r\n      yield v;\r\n      break;\r\n    }\r\n  }\r\n  yield* it;\r\n}\r\n\r\n/**\r\n * Returns true if items in two iterables are equal, as\r\n * determined by the `equality` function.\r\n * @param it1 \r\n * @param it2 \r\n * @param equality \r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function equals<V>(it1:Iterable<V>, it2:Iterable<V>, equality?:IsEqual<V>) {\r\n  // https://surma.github.io/underdash/\r\n  const iit1 = it1[Symbol.iterator]();\r\n  const iit2 = it2[Symbol.iterator]();\r\n  //eslint-disable-next-line functional/no-loop-statement,no-constant-condition\r\n  while (true) {\r\n    const i1 = await iit1.next(), i2 = await iit2.next();\r\n    if (equality !== undefined) {\r\n      if (!equality(i1.value, i2.value)) return false;\r\n    } else if (i1.value !== i2.value) return false;\r\n    if (i1.done || i2.done) return i1.done && i2.done;\r\n  }\r\n}\r\n\r\n/**\r\n * Returns _true_ if `f` returns _true_ for \r\n * every item in iterable\r\n * @param it \r\n * @param f \r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function every<V>(it:Iterable<V>, f:(v:V) => boolean) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-let\r\n  let ok = true;\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) ok = ok && f(v);\r\n  return ok;\r\n}\r\n\r\n/**\r\n * Yields `v` for each item within `it`.\r\n * \r\n * ```js\r\n * fill([1, 2, 3], 0);\r\n * // Yields: [0, 0, 0]\r\n * ```\r\n * @param it \r\n * @param v \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* fill<V>(it:AsyncIterable<V>, v:V) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const _ of it) yield v;\r\n}\r\n\r\n/**\r\n * Filters an iterable, returning items which match `f`.\r\n * \r\n * ```js\r\n * filter([1, 2, 3, 4], e => e % 2 == 0);\r\n * returns [2, 4]\r\n * ```\r\n * @param it \r\n * @param f \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* filter<V>(it:AsyncIterable<V>, f:(v:V) => boolean) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) {\r\n    if (!f(v)) continue;\r\n    yield v;\r\n  }\r\n}\r\n\r\n/**\r\n * Returns first item from iterable `it` that matches predicate `f`\r\n * ```js\r\n * find([1, 2, 3, 4], e => e > 2);\r\n * // Yields: 3\r\n * ```\r\n * @param it \r\n * @param f \r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function find<V>(it:AsyncIterable<V>, f:(v:V) => boolean) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) { \r\n    if (f(v)) return v;\r\n  } \r\n}\r\n\r\n/**\r\n * Returns a 'flattened' copy of array, un-nesting arrays one level\r\n * ```js\r\n * flatten([1, [2, 3], [[4]]]);\r\n * // Yields: [1, 2, 3, [4]];\r\n * ```\r\n * @param it \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* flatten<V>(it:AsyncIterable<V>) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) {\r\n    if (Symbol.asyncIterator in v) { \r\n      // @ts-ignore\r\n      yield* v;\r\n    } else {\r\n      yield v;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Execute function `f` for each item in iterable\r\n * @param it \r\n * @param f \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function forEach<V>(it:AsyncIterable<V>, f:(v:V) => boolean) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) f(v);\r\n}\r\n\r\n/**\r\n * Maps an iterable of type `V` to type `X`.\r\n * ```js\r\n * map([1, 2, 3], e => e*e)\r\n * returns [1, 4, 9]\r\n * ```\r\n * @param it \r\n * @param f \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* map<V, X>(it:AsyncIterable<V>, f:(v:V) => X) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) { \r\n    yield f(v);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the maximum seen of an iterable\r\n * ```js\r\n * min([\r\n *  {i:0,v:1},\r\n *  {i:1,v:9},\r\n *  {i:2,v:-2}\r\n * ], (a, b) => a.v > b.v);\r\n * // Yields: {i:1, v:-9}\r\n * ```\r\n * @param it Iterable\r\n * @param gt Should return _true_ if `a` is greater than `b`.\r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function max<V>(it:AsyncIterable<V>, gt = (a:V, b:V) => a > b) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  //eslint-disable-next-line functional/no-let\r\n  let max;\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) {\r\n    if(!max) {\r\n      max = v;\r\n      continue;\r\n    }\r\n    max = gt(max, v)?max:v;\r\n  }\r\n  return max;\r\n}\r\n\r\n/**\r\n * Returns the minimum seen of an iterable\r\n * ```js\r\n * min([\r\n *  {i:0,v:1},\r\n *  {i:1,v:9},\r\n *  {i:2,v:-2}\r\n * ], (a, b) => a.v > b.v);\r\n * // Yields: {i:2, v:-2}\r\n * ```\r\n * @param it Iterable\r\n * @param gt Should return _true_ if `a` is greater than `b`.\r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function min<V>(it:AsyncIterable<V>, gt = (a:V, b:V) => a > b) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-let\r\n  let min;\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) {\r\n    if(!min) {\r\n      min = v;\r\n      continue;\r\n    }\r\n    min = gt(min, v)?v:min;\r\n  }\r\n  return min;\r\n}\r\n\r\n/**\r\n * Returns count from `start` for a given length\r\n * ```js\r\n * range(-5, 10);\r\n * // Yields: [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4]\r\n * ```\r\n * @param start \r\n * @param len \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* range(start:number, len:number) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-let,functional/no-loop-statement\r\n  for (let i=0;i<len;i++) {\r\n    yield start++;\r\n  }\r\n  //for (let i=len;len > 0; len--) yield start++;\r\n}\r\n\r\n/**\r\n * Reduce for iterables\r\n * ```js\r\n * reduce([1, 2, 3], (acc, cur) => acc + cur, 0);\r\n * // Yields: 6\r\n * ```\r\n * @param it Iterable\r\n * @param f Function\r\n * @param start Start value\r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function reduce<V>(it:AsyncIterable<V>, f:(acc:V, current:V) => V, start:V) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) start = f(start, v);\r\n  return start;\r\n}\r\n\r\n/**\r\n * Returns a section from an iterable\r\n * @param it Iterable\r\n * @param start Start index\r\n * @param end End index (or until completion)\r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* slice<V>(it:AsyncIterable<V>, start = 0, end = Number.POSITIVE_INFINITY) {\r\n  // https://surma.github.io/underdash/\r\n  const iit = it[Symbol.asyncIterator]();\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for(; start > 0; start--, end--) await iit.next();\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) { \r\n    if (end-- > 0) { \r\n      yield v;\r\n    } else { \r\n      break; \r\n    } \r\n  }\r\n}\r\n\r\n/**\r\n * Returns true the first time `f` returns true. Useful for spotting any occurrence of\r\n * data, and exiting quickly \r\n * ```js\r\n * some([1, 2, 3, 4], e => e % 3 === 0);\r\n * // Yields: true\r\n * ```\r\n * @param it Iterable\r\n * @param f Filter function\r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function some<V>(it:AsyncIterable<V>, f:(v:V) => boolean) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) { \r\n    if (f(v)) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Returns items for which the filter function returns _true_\r\n * ```js\r\n * takeWhile([ 1, 2, 3, 4 ], e => e < 3);\r\n * // Yields: [ 1, 2 ]\r\n * ```\r\n * @param it Iterable\r\n * @param f Filter function\r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* takeWhile<V>(it:AsyncIterable<V>, f:(v:V) => boolean) {\r\n  // https://surma.github.io/underdash/\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) {\r\n    if (!f(v)) return;\r\n    yield v;\r\n  }\r\n}\r\n\r\n/**\r\n * Returns an array of values from an iterator.\r\n * \r\n * ```js\r\n * const data = await toArray(adsrSample(opts, 10));\r\n * ```\r\n * \r\n * Note: If the iterator is infinite, be sure to provide a `count` or the function\r\n * will never return.\r\n * \r\n * @param it Asynchronous iterable\r\n * @param count Number of items to return, by default all.\r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function toArray<V>(it:AsyncIterable<V>, count = Infinity):Promise<readonly V[]> {\r\n  // https://2ality.com/2016/10/asynchronous-iteration.html\r\n  const result = [];\r\n  const iterator = it[Symbol.asyncIterator]();\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  while (result.length < count) {\r\n    const {value, done} = await iterator.next();\r\n    if (done) break;\r\n    //eslint-disable-next-line functional/immutable-data\r\n    result.push(value);\r\n  }\r\n  return result;\r\n\r\n}\r\n\r\n\r\n/**\r\n * Returns unique items from iterables, given a particular key function\r\n * ```js\r\n * unique([{i:0,v:2},{i:1,v:3},{i:2,v:2}], e => e.v);\r\n * Yields:  [{i:0,v:2},{i:1,v:3}]\r\n * @param it \r\n * @param f \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* unique<V>(it:AsyncIterable<V>, f:((id:V) => V) = id => id) {\r\n  // https://surma.github.io/underdash/\r\n  const buffer = [];\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  for await (const v of it) {\r\n    const fv = f(v);\r\n    if (buffer.indexOf(fv) !== -1) continue;\r\n    //eslint-disable-next-line functional/immutable-data\r\n    buffer.push(fv);\r\n    yield v;\r\n  }\r\n}\r\n\r\n/**\r\n * Combine same-positioned items from several iterables\r\n * ```js\r\n * zip( [1, 2, 3], [4, 5, 6], [7, 8, 9] );\r\n * Yields: [ [1, 4, 7], [2, 5, 8], [3, 6, 9] ]\r\n * ```\r\n * @param its \r\n * @returns \r\n */\r\n//eslint-disable-next-line func-style\r\nexport async function* zip<V>(...its:readonly AsyncIterable<V>[]) {\r\n  // https://surma.github.io/underdash/\r\n  const iits = its.map(it => it[Symbol.asyncIterator]());\r\n  //eslint-disable-next-line functional/no-loop-statement\r\n  while(true) {\r\n    const vs = await Promise.all(iits.map(it => it.next()));\r\n    if (vs.some(v => v.done)) return;\r\n    yield vs.map(v => v.value);\r\n  }\r\n}"],"mappings":"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","names":[]}